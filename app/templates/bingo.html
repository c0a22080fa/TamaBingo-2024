{% extends "base.html" %}

{% block title %}ビンゴページ{% endblock %}

{% block content %}
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>デジタルビンゴ - Enjoy Tama with Bingo</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/bingo.css') }}">
</head>
<h1>ビンゴシート</h1>

<button id="start-camera">カメラを起動する</button>

<div id="bingo-wrapper">
    <table id="bingo-table">
        {% for i in range(3) %}
        <tr>
            {% for j in range(3) %}
            {% set cell_index = i * 3 + j %}
            <td id="cell-{{ cell_index }}" class="{{ 'checked' if bingo_sheet[cell_index] else '' }}">
                {% if bingo_sheet[cell_index] %}
                    <!-- チェック済みの場合、該当の画像を表示 -->
                    <img src="{{ url_for('static', filename='images/stamp/tamabingo_stamp.png') }}" alt="スタンプ {{ cell_index + 1 }}">
                {% else %}
                    <!-- 未チェックのセル番号を丸で囲んで表示 -->
                    <div class="circle">{{ cell_index + 1 }}</div>
                {% endif %}
            </td>
            {% endfor %}
        </tr>
        {% endfor %}
    </table>
</div>

<br>

<div id="qr-reader"></div>

<div id="overlay" class="overlay">
    <div class="overlay-content">
        <h2 id="spot-name"></h2>
        <p id="spot-trivia"></p>
        <button class="close-overlay" onclick="closeOverlay()">閉じる</button>
    </div>
</div>

<!-- 景品交換ボタン表示ロジック -->
{% if exchanged %}
    <button class="exchange-button" disabled>景品は交換済みです</button>
{% else %}
    <button id="exchange-prize" class="exchange-button">景品を交換する</button>
{% endif %}

<div id="exchange-popup" class="exchange-popup-overlay">
    <div class="exchange-popup-content">
        <h2 id="exchange-message">本当に交換しますか？</h2>
        <button id="confirm-exchange" class="popup-button">はい</button>
        <button id="cancel-exchange" class="popup-button">いいえ</button>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/html5-qrcode/minified/html5-qrcode.min.js"></script>
<script src="{{ url_for('static', filename='js/bingo.js') }}"></script>
{% endblock %}
